title: centos 6.5 安装gitlab安装需注意的问题
date: 2015-02-06 23:30:50
tags: [centos,gitlab]
categories: gitlab
---
安装gitlab
首先按照官网进行操作，环境为centos 6.5
https://about.gitlab.com/downloads/
注意安装过程中执行命令
```bash
sudo gitlab-ctl reconfigure
```
出现错误，在`/etc/gitlab/gitlab.rb`中修改域名后再执行一次方可启动成功
![image](http://img.blog.csdn.net/20141207182607301?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveWZpc2Fib3k=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center)
<!--more-->
进页面提示`502`，用命令查看日志
```bash
sudo gitlab-ctl tail postgresql  
```
提示内存不足，官方也是建议1g内存进行搭建，512m的话也可以安装但是要添加swap，不然启动后就会提示内存不足，我目前是512的，添加*swap*后访问成功，但是有点慢可能，还是升为1g最好。

上面的图是我目前的配置，注意这里修改了gitlab默认的仓库存储路径，教程官网有      
https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/README.md
我这里贴出来给大家看看
#### Storing Git data in an alternative directory
```bash
# Prevent users from writing to the repositories while you move them.
sudo gitlab-ctl stop
# Only move 'repositories'; 'gitlab-satellites' will be recreated
# automatically. Note there is _no_ slash behind 'repositories', but there _is_ a
# slash behind 'git-data'.
sudo rsync -av /var/opt/gitlab/git-data/repositories /mnt/nas/git-data/
# Fix permissions if necessary
sudo gitlab-ctl reconfigure
# Double-check directory layout in /mnt/nas/git-data. Expected output:
# gitlab-satellites repositories
sudo ls /mnt/nas/git-data/
# Done! Start GitLab and verify that you can browse through the repositories in
# the web interface.
sudo gitlab-ctl start
```
可以看到这下面是安装完成后gitlab一些文件和数据的路径    
> 注：看到网上很多资料都不对，可能是过时了，所以搞gitlab建议大家还是以官网为主，说不定你在看我这个文章的时候也过时了

#### Omnibus-gitlab uses four different directories.
* `/opt/gitlab` holds application code for GitLab and its dependencies.
* `/var/opt/gitlab` holds application data and configuration files that gitlab-ctl reconfigure writes to.
* `/etc/gitlab` holds configuration files for omnibus-gitlab. These are the only files that you should ever have to edit manually.
* `/var/log/gitlab` contains all log data generated by components of omnibus-gitlab.

有错误的时候尽量用 
```bash
sudo gitlab-ctl tail
``` 
查看日志分析错误原因，我在配置邮件的时候也是试了很久才用上

接下来我们来配置邮件，我这里使用SMTP，用腾讯企业邮箱
还是修改`/etc/gitlab/gitlab.rb` 配置文件，再次**提醒**网上很多文章可以已经过时了
附上官网地址
https://gitlab.com/gitlab-org/omnibus-gitlab/blob/master/doc/settings/smtp.md
```ruby
gitlab_rails['smtp_enable'] = true  
gitlab_rails['smtp_address'] = "smtp.exmail.qq.com"  
gitlab_rails['smtp_port'] = 25  
gitlab_rails['smtp_user_name'] = "xx@xxx.com"  
gitlab_rails['smtp_password'] = "password"  
gitlab_rails['smtp_domain'] = "exmail.qq.com"  
gitlab_rails['smtp_authentication'] = "login"  
gitlab_rails['smtp_enable_starttls_auto'] = true  
gitlab_rails['gitlab_email_from'] = 'xx@xxx.com'  
##修改gitlab配置的发信人  
user["git_user_email"] = "xx@xxx.com"  
```

保持发信人和登录邮箱一致,我配置这里的时候也出错了，原因是我在看腾讯官网时候写的是用的SSL，端口是465
但是gitlab好像不是用的`ssl`，gitlab的教程里也没找到是否启用ssl的配置，我也没去深究了，于是把端口号改为`25`，邮件发送成功。
大家在测试邮件的时候可以用忘记密码来发送邮件测试，然后用`gitlab-ctl tail`来查看，大概等1分钟就能看到发送邮件的日志，出错了再具体分析原因