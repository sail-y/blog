---
title: 并发编程2-线程安全性
date: 2016-12-02 10:19:08
tags: [java, 并发]
categories: 并发
---

#线程安全性
在构建文件的并发程序时，必须正确地使用线程和锁，但这些终归只是一些机制。要编写线程安全的代码，其核心在于要对状态访问操作进行管理，特别是对共享的和可变的状态的访问。一个对象是否是线程安全的，取决于它是否被多个线程同事访问。当多个线程访问某个状态变量并且其中有一个线程执行写入操作时，必须采用同步机制来协同这些线程对变量的访问。Java中的主要同步机制是关键字synchronized，它提供了一种独占的枷锁方式，但「同步」这个术语还包括volatile类型的变量，显式锁以及原子变量。

>如果当多个线程访问同一个可变的状态变量时没有使用合适的同步，那么程序就会初夏你错误。有三种方式可以修复这个问题：		
>不在线程之间共享该状态变量		
>将状态变量改为不可变的变量		
>在访问状态变量时使用同步

## 什么是线程安全性
当多个线程访问某个类时，不管运行时环境采用何种调度方式或者这些线程将如何交替执行，并且在主调代码中不需要任何额外的同步或协同，这个类都能表现出正确的行为，那么就称这个类是线程安全的。在线程安全类中封装了必要的同步机制，因此客户端无须进一步采取同步措施。
无状态对象一定是线程安全的。（没有共享数据）
## 原子性
像count++这种是属于非原子操作，它包含了三个独立的操作：读取count的值，将值+1，然后将计算结果写入count。所以不同线程在自增的时候，这个值在第一步拿到的可能是过期的数据。		
在并发编程中，这种由于不恰当的执行时序出现不正确的结果是一种非常重要的情况，它有一个正式的名字：竞态条件。

### 竞态条件
当某个计算的正确性取决于多个线程的交替执行时序时，那么就会发生竞态条件。